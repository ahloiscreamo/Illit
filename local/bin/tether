#!/bin/sh

INTERFACE="usb0"

echo "--- USB Tethering Reset Script (Service-Friendly) ---"

# 1. Stop dhcpcd management on this specific interface.
echo "1. Stopping dhcpcd on $INTERFACE..."
sudo dhcpcd -k "$INTERFACE" 2>/dev/null

# 2. Reset the link state to clear any stale kernel configuration.
echo "2. Toggling link state..."
sudo ip link set "$INTERFACE" down
sudo ip link set "$INTERFACE" up
sleep 1

# 3. Request IP using the FOSS alternative client (dhclient)
echo "3. Requesting IP using dhclient..."
sudo dhclient "$INTERFACE"

# 4. Verification
echo "--- Verification ---"
ip a show "$INTERFACE" | grep 'inet '
ip route show | grep default
ping -c 3 8.8.8.8
